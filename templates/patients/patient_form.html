{% extends 'users/staff_base.html' %}

{% block inner_content %}
<div class="max-w-2xl mx-auto">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold">
      {% if object %}Edytuj pacjenta{% else %}Dodaj nowego pacjenta{% endif %}
    </h1>
    <a href="{% url 'patients:list' %}" class="btn btn-ghost">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg>
      Powrót do listy
    </a>
  </div>

  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <form method="post" novalidate>
        {% csrf_token %}
        
        {% if form.non_field_errors %}
          <div class="alert alert-error mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <div>
              {% for error in form.non_field_errors %}
                <div>{{ error }}</div>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          {# Imię #}
          <div class="form-control">
            <label class="label" for="{{ form.first_name.id_for_label }}">
              <span class="label-text font-medium">{{ form.first_name.label }}</span>
              <span class="label-text-alt text-error">*</span>
            </label>
            {{ form.first_name }}
            {% if form.first_name.errors %}
              <label class="label">
                <span class="label-text-alt text-error">
                  {% for error in form.first_name.errors %}{{ error }}{% endfor %}
                </span>
              </label>
            {% endif %}
          </div>

          {# Nazwisko #}
          <div class="form-control">
            <label class="label" for="{{ form.last_name.id_for_label }}">
              <span class="label-text font-medium">{{ form.last_name.label }}</span>
              <span class="label-text-alt text-error">*</span>
            </label>
            {{ form.last_name }}
            {% if form.last_name.errors %}
              <label class="label">
                <span class="label-text-alt text-error">
                  {% for error in form.last_name.errors %}{{ error }}{% endfor %}
                </span>
              </label>
            {% endif %}
          </div>
        </div>

        {# PESEL #}
        <div class="form-control">
          <label class="label" for="{{ form.pesel.id_for_label }}">
            <span class="label-text font-medium">{{ form.pesel.label }}</span>
            <span class="label-text-alt text-error">*</span>
          </label>
          {{ form.pesel }}
          {% if form.pesel.errors %}
            <label class="label">
              <span class="label-text-alt text-error">
                {% for error in form.pesel.errors %}{{ error }}{% endfor %}
              </span>
            </label>
          {% endif %}
          <label class="label">
            <span class="label-text-alt">11 cyfr bez spacji i myślników</span>
          </label>
        </div>

        {# Email #}
        <div class="form-control">
          <label class="label" for="{{ form.email.id_for_label }}">
            <span class="label-text font-medium">{{ form.email.label }}</span>
          </label>
          {{ form.email }}
          {% if form.email.errors %}
            <label class="label">
              <span class="label-text-alt text-error">
                {% for error in form.email.errors %}{{ error }}{% endfor %}
              </span>
            </label>
          {% endif %}
        </div>

        {# Telefon #}
        <div class="form-control">
          <label class="label" for="{{ form.phone.id_for_label }}">
            <span class="label-text font-medium">{{ form.phone.label }}</span>
          </label>
          {{ form.phone }}
          {% if form.phone.errors %}
            <label class="label">
              <span class="label-text-alt text-error">
                {% for error in form.phone.errors %}{{ error }}{% endfor %}
              </span>
            </label>
          {% endif %}
        </div>

        {# Przyciski #}
        <div class="form-control mt-6">
          <div class="flex gap-3 justify-end">
            <a href="{% url 'patients:list' %}" class="btn btn-ghost">
              Anuluj
            </a>
            <button type="submit" class="btn btn-primary">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              {% if object %}Zaktualizuj{% else %}Dodaj pacjenta{% endif %}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

{# JavaScript dla lepszego UX #}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Automatyczne formatowanie PESEL podczas wpisywania
  const peselInput = document.querySelector('input[name="pesel"]');
  if (peselInput) {
    peselInput.addEventListener('input', function(e) {
      // Usuwamy wszystko co nie jest cyfrą
      let value = e.target.value.replace(/\D/g, '');
      // Ograniczamy do 11 cyfr
      if (value.length > 11) {
        value = value.slice(0, 11);
      }
      e.target.value = value;
    });
  }

  // Focus na pierwszym polu
  const firstInput = document.querySelector('input[name="first_name"]');
  if (firstInput) {
    firstInput.focus();
  }

  // Obsługa wysyłania formularza klawiszem Enter
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && e.ctrlKey) {
      document.querySelector('form').submit();
    }
  });
});
</script>

<style>
/* Dodatkowe style dla formularza */
.form-control input:focus,
.form-control textarea:focus,
.form-control select:focus {
  outline: none;
  border-color: oklch(var(--p));
  box-shadow: 0 0 0 2px oklch(var(--p) / 0.2);
}

.form-control input.input-error,
.form-control textarea.textarea-error,
.form-control select.select-error {
  border-color: oklch(var(--er));
}

/* Responsywność */
@media (max-width: 768px) {
  .grid-cols-1.md\\:grid-cols-2 {
    grid-template-columns: 1fr;
  }
}
</style>

{% endblock %}